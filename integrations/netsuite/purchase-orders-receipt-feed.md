# Purchase Orders Receipt Feed

## Requirement

The objective of this requirement is to implement an automated system for sending the Purchase Orders Receipt Feed to Netsuite. The feed should include purchase order information.

This is a sample JSON containing records of a Purchase Orders Receipt feed-

```json
[ {
  "order_id" : "8302919",
  "items" : [ {
    "line_id" : "1",
    "quantity" : "100"
  }, {
    "line_id" : "2",
    "quantity" : "200"
  }, {
    "line_id" : "3",
    "quantity" : "150"
  }, {
    "line_id" : "4",
    "quantity" : "100"
  }, {
    "line_id" : "5",
    "quantity" : "50"
  } ]
} ]

```

## Design and Decisions

Purchase Orders Receipt feed is generated using Moqui and Nifi. A dedicated service in Moqui fetches data from PurchaseOrderShipmentReceipt View. This data is transformed into the desired format using NiFi.


## Implementation Flow

### Moqui:

A scheduled service jobs fetches eligible records and generates generic order wise feed file containing details of purchase orders and receipt details.


### NiFi:

NiFi reads the Purchase Orders Feed file generated by Moqui from the SFTP location. Here, NiFi limits the number of orders in a single file to 400. Then the Moqui generated JSON is transformed as per Netsuite format and put to SFTP.

## NiFi Flow

Below is the step wise NiFi processors configuration-

#### 1. ListSFTP

The ListSFTP processor reads the Purchase Orders Receipt feed file details from the SFTP location.

#### 2. FetchSFTP

The FetchSFTP processor fetches the file from SFTP using the information read by ListSFTP processor and moves a copy of the Purchase Orders Receipt feed file into an archive folder. Archived files are kept as record of sent files.

#### 3. SplitRecord

The SplitRecord processor limits the number of orders to a given number in a single file.

#### 4. JoltTransformJSON

The JoltTransformJSON processor fetches the Netsuite Required details from the generic Moqui generated Purchase Orders Receipt feed.

#### 5. UpdateAttribute

The UpdateAttribute processor is used to update the file name of Purchase Orders Receipt Feed file.

#### 6. PutSFTP

The PutSFTP processor is used to put the Purchase Orders Receipt Feed file at the SFTP.

## Mapping of the fields of HC to NetSuite 
| Fields  | Data Type | Description | HC Field Mapping  |
|---------|-----------|-------------|-------------------|
|order_id |string     |order id     | OrderHeader.ExternalId|
|items.line_id |string|Line id| OrderItem.orderItemExternalId|
|items.quantity |string|Quantity| ShipmentReceipt.totalQuantityAccepted|

